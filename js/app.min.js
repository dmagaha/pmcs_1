var taskBoardServices=angular.module("TaskBoardServices",[]),taskBoardControllers=angular.module("TaskBoardControllers",[]),taskBoardDirectives=angular.module("TaskBoardDirectives",[]),taskBoard=angular.module("TaskBoard","ngRoute ngSanitize ng-context-menu TaskBoardServices TaskBoardControllers TaskBoardDirectives".split(" "));
taskBoard.config(["$routeProvider","$httpProvider",function(a,c){a.when("/",{controller:"LoginCtrl",templateUrl:"partials/login.html"}).when("/boards",{controller:"BoardCtrl",templateUrl:"partials/boardSelect.html",authRequired:!0}).when("/boards/:boardId",{controller:"BoardCtrl",templateUrl:"partials/board.html",authRequired:!0,resolve:{validation:["$q","$route",function(a,b){var c=a.defer(),f=parseInt(b.current.params.boardId);isNaN(f)?c.reject("INVALID BOARD ID"):c.resolve();return c.promise}]}}).when("/OffsiteView",
{controller:"FrontDeskCtrl",templateUrl:"partials/offsite.html",authRequired:!0}).when("/ProductionManager",{controller:"FrontDeskCtrl",templateUrl:"partials/shopManager.html",authRequired:!0}).when("/DetailCleanup",{controller:"FrontDeskCtrl",templateUrl:"partials/detailCleanupView.html",authRequired:!0}).when("/ShopManager",{controller:"FrontDeskCtrl",templateUrl:"partials/shopManager.html",authRequired:!0}).when("/ReportView",{controller:"FrontDeskCtrl",templateUrl:"partials/reportView.html",authRequired:!0}).when("/WriterView",
{controller:"FrontDeskCtrl",templateUrl:"partials/writerView.html",authRequired:!0}).when("/TechView",{controller:"FrontDeskCtrl",templateUrl:"partials/techView.html",authRequired:!0}).when("/PartsView",{controller:"FrontDeskCtrl",templateUrl:"partials/parts.html",authRequired:!0}).when("/FrontDesk",{controller:"FrontDeskCtrl",templateUrl:"partials/frontDesk.html",authRequired:!0}).when("/settings",{controller:"SettingsCtrl",templateUrl:"partials/settings.html",authRequired:!0}).when("/files/:fileId",
{controller:"FilesCtrl",templateUrl:"partials/files.html",authRequired:!0}).otherwise({redirectTo:"/"});c.interceptors.push("TokenInterceptor")}]);
taskBoard.run(["$rootScope","$location","$window","AuthenticationService",function(a,c,d,b){a.version="v0.1.0";a.$on("$routeChangeStart",function(a,f,h){null===f||null===f.authRequired||!f.authRequired||b.isAuthenticated||d.localStorage.token||c.path("/");null!==f&&"LoginCtrl"===f.controller&&d.localStorage.token&&c.path("/boards")});a.$on("$routeChangeSuccess",function(a,c,d){"LoginCtrl"===c.controller&&d&&""!==d.originalPath&&(b.attemptedRoute=d)});a.$on("$routeChangeError",function(a,b,d,g){"INVALID BOARD ID"===
g&&c.path("/boards")})}]);taskBoardControllers.controller("BoardCtrl",["$scope","$routeParams","$location","$interval","$window","UserService","TeamService","BoardService","AlertService","AuthenticationService",function(a,c,d,b,e,f,h,g,p,k){if(k.attemptedRoute){var q=k.attemptedRoute,m=q.originalPath;q.keys.forEach(function(a){m=m.replace(":"+a.name,q.params[a.name])});k.attemptedRoute=null;d.path(m)}a.quickAdd={title:[]};a.alerts=p;a.marked=function(b){return b?e.marked(hyperlink(b,a.trackers)):""};a.boardId=c.boardId;a.filter=
{user:null,category:null,hide:!1};a.filterChanged=function(){a.currentBoard.ownLane.forEach(function(b){b.ownItem&&b.ownItem.forEach(function(b){b.filtered=!1;null!==a.filter.user&&a.filter.user!=b.assignee&&(b.filtered=!0);null!==a.filter.category&&a.filter.category!=b.category&&(b.filtered=!0)})})};a.selectBoard=function(){d.path("boards/"+a.boardNames.current)};a.openEditItem=function(){a.itemFormData.loadItem(a.contextItem);$(".itemModal textarea").css("height","auto");$(".itemModal").modal("show")};
a.openAddItem=function(){a.itemFormData.reset(a.contextLaneId);$(".itemModal textarea").css("height","auto");$(".itemModal").modal("show")};a.removeItem=function(){a.openItem(a.contextItem,!1);a.deleteItem()};a.changeItemLane=function(){a.itemFormData.loadItem(a.contextItem);a.itemFormData.isAdd=!1;a.submitItem(a.itemFormData)};a.contextItem={};a.onContextMenu=function(b,c){a.contextItem=c;a.contextLaneId=b};a.interval=b(function(){a.boardId&&b.cancel(a.interval);a.boardsLoaded&&!a.boardId&&a.currentUser&&
parseInt(a.currentUser.defaultBoard)&&(b.cancel(a.interval),d.path("boards/"+a.currentUser.defaultBoard))},250);a.$on("$destroy",function(){b.cancel(a.interval)});a.boards=[];a.boardsLoaded=!1;a.boardNames=[];a.userNames=[];a.techNames=[];a.laneNames=[];a.categories=[];a.trackers=[];a.loadingTechs=!0;a.loadingTeams=!0;a.currentBoard={loading:!0,name:"PMCS"};var n=!1,r=3,l=!1,u=3;a.loadTechs=function(){l||(l=!0,f.getTechs().success(function(b){a.updateTechList(b.data);l=!1;u=3}).error(function(){u--?
l=!1:(b.cancel(a.interval),a.$parent.loadingTechs=!1)}))};a.loadTeams=function(){n||(n=!0,h.getTeams().success(function(b){a.updateTeamsList(b.data);n=!1;r=3}).error(function(){r--?n=!1:(b.cancel(a.interval),a.$parent.loadingTeams=!1)}))};var t=!1,s=0;a.isActiveFilter=function(b){var c=!1;a.boards.forEach(function(a){a.id===b.id&&(c="1"===a.active)},this);return c};a.loadBoards=function(){t||s||(t=!0,g.getBoards().success(function(b){t=!1;a.updateBoards(b)}))};a.loadBoards();a.loadTeams();a.loadTechs();
a.teamInterval=b(a.loadTeams,5E3);a.techInterval=b(a.loadTechs,5E3);a.boardInterval=b(a.loadBoards,1E4);a.$on("$destroy",function(){b.cancel(a.boardInterval)});a.updateTechList=function(b){if(void 0!==b)if(a.loadingTechs=!1,null===b)a.techs=[];else{a.techs=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.techNames=c;b=0;for(var e=c.length;b<e;b++)a.techLookup[c[b].id]=c[b].name}};a.updateTeamsList=function(b){if(void 0!==b)if(a.loadingTeams=!1,null===b)a.teams=[];else{a.teams=b;
var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.teamNames=c;b=0;for(var e=c.length;b<e;b++)a.teamLookup[c[b].id]=c[b].name}};a.updateBoards=function(b){if(0===s){a.boards=b.data;a.boardsLoaded=!0;var c=!1;a.boards&&(a.boardNames=[],a.boards.forEach(function(b){1===parseInt(b.active)&&a.boardNames.push({id:b.id,name:b.name});b.id==a.boardId&&(b.sharedUser.unshift({id:0,username:"Unassigned"}),b.sharedUser.forEach(function(b){a.userNames[b.id]=b.username}),b.ownLane.forEach(function(b){a.laneNames[b.id]=
b.name;b.ownItem&&b.ownItem.forEach(function(a){if(1==a.repair_lane){if(null!=a.tear_down_start_date){var b=new Date(1E3*a.tear_down_start_date),c=b.getMonth()+1,e="",e=10>c?"0"+c:c,c=b.getDate(),b=b.getFullYear();a.tear_down_start_date=e+"/"+c+"/"+b}e=new Date(a.due_date);e-=Date.now();0>e?a.datePast=!0:2592E5>e&&(a.dateNear=!0)}7==a.repair_lane&&(e=new Date(a.service_due_date),e-=Date.now(),0>e?a.datePast=!0:2592E5>e&&(a.dateNear=!0));4==a.repair_lane&&(e=new Date(a.body_due_date),e-=Date.now(),
0>e?a.datePast=!0:2592E5>e&&(a.dateNear=!0));5==a.repair_lane&&(e=new Date(a.refinish_due_date),e-=Date.now(),0>e?a.datePast=!0:2592E5>e&&(a.dateNear=!0));6==a.repair_lane&&(e=new Date(a.trim_out_due_date),e-=Date.now(),0>e?a.datePast=!0:2592E5>e&&(a.dateNear=!0));a.position=parseInt(a.position)})}),b.ownCategory&&(b.ownCategory.unshift({id:0,name:"Uncategorized",color:"#ffffe0"}),b.ownCategory.forEach(function(b){a.categories[b.id]=b.name})),b.ownTracker&&b.ownTracker.forEach(function(b){a.trackers[b.id]=
[b.name,b.bugexpr]}),a.currentBoard=b,a.boardNames.current=b.id,c=!0)}));c?(a.filterChanged(),a.currentBoard.loading=!1,"0"===a.currentBoard.active&&(a.currentBoard={loading:!0,name:"PMCS",error:!0})):a.currentBoard.error=!0}};a.toggleLane=function(b){b.collapsed=!b.collapsed;s++;g.toggleLane(b.id).success(function(b){s--;a.updateBoards(b)})};a.updateSortables=function(){var a=this.$parent;$(".itemContainer").sortable({connectWith:".itemContainer",placeholder:"draggable-placeholder",items:"div:not(.addItem, .itemHeader, .description)",
change:function(a,b){var c=$(b).parent(),e=c.find(".addItem");e.detach();c.append(e)},stop:function(b,c){var e=$.find(".boardColumn"),f=[];$(e).each(function(){var a=$(this).attr("data-lane-id");$(this).find(".boardItem").each(function(b){var c=$(this).attr("data-item-id");f.push({item:c,lane:a,position:b})})});a.updatePositions(f)}})};a.updatePositions=function(b){s++;g.updateItemPositions(b).success(function(b){s--;a.updateBoards(b)})};a.currentUser={};a.userLoaded=!1;a.updateCurrentUser=function(){f.currentUser().success(function(b){a.userLoaded=
!0;a.currentUser=b.data})};a.updateCurrentUser()}]);taskBoardControllers.controller("ItemFormBoardCtrl",["$scope","BoardService",function(a,c){a.itemFormData={setFocus:!1,isSaving:!1,isAdd:!0,itemId:0,title:"",titleError:!1,description:"",assignee:0,category:0,lane:0,color:"#ffffe0",dueDate:null,points:null,pointsError:!1,reset:function(b){$(".popover-dismiss").popover({html:!0});this.setFocus=!0;this.isSaving=!1;this.isAdd=!0;this.itemId=0;this.title="";this.titleError=!1;this.description="";this.category=this.assignee=0;this.lane=b||0;this.color=
"#ffffe0";this.spectrum();this.points=this.dueDate=null;this.pointsError=!1;var c=this;$(".itemModal").on("hidden.bs.modal",function(a){c.reset()});a.quickAdd.title[b]&&this.quickAddItem(b)},quickAddItem:function(b){$(".itemModal").on("show.bs.modal",function(a){a.stopPropogation()});this.title=a.quickAdd.title[b];a.submitItem(this);delete a.quickAdd.title[b]},loadItem:function(a){this.reset(a.lane_id);this.isAdd=!1;this.itemId=a.id;this.title=a.title;this.description=a.description;this.assignee=
"0"===a.assignee?0:a.assignee;this.category="0"===a.category?0:a.category;this.color=a.color;this.spectrum(this.color);this.dueDate=a.due_date;this.points=parseInt(a.points);this.position=a.position},cancel:function(){$(".itemModal").modal("hide");$("#spectrum").spectrum("hide");$("#spectrum").spectrum("enable")},spectrum:function(a){a=a||"#ffffe0";$("#spectrum").spectrum({color:a,allowEmpty:!1,localStorageKey:"taskboard.colorPalette",showPalette:!0,palette:["#fff #ececec #ffffe0 #ffe0fa #bee7f4 #c3f4b5 #debee8 #ffdea9 #ffbaba".split(" ")],
showSelectionPalette:!0,showButtons:!1,showInput:!0,preferredFormat:"hex3",appendTo:"#addEdit"})},datePicker:function(){$("#datepicker").datepicker()}};a.$parent.itemFormData=a.itemFormData;a.submitItem=function(b){b.isSaving=!0;$("#spectrum").spectrum("disable");b.titleError=!1;""===b.title?(a.alerts.showAlert({type:"error",text:"Title is required to add a new item."}),b.isSaving=!1,b.titleError=!0):(b.pointsError=!1,void 0===b.points?(a.alerts.showAlert({type:"error",text:"Points must be greater than or equal to zero (or left empty)."}),
b.isSaving=!1,b.pointsError=!0):b.isAdd?c.addItem(b,a.currentBoard.id).success(function(a){d(a)}):c.updateItem(b).success(function(a){d(a)}))};a.$parent.submitItem=a.submitItem;var d=function(b){a.alerts.showAlerts(b.alerts);"success"==b.alerts[0].type&&(a.updateBoards(b),a.itemFormData.cancel())}}]);taskBoardControllers.controller("ItemViewBoardCtrl",["$scope","$window","BoardService",function(a,c,d){a.viewItem={};a.comment={};a.toggle={sidebar:!1};a.fileReset=!1;a.comments={options:[{id:0,text:"Oldest First"},{id:1,text:"Newest First"}],sorting:0};a.markedComment=function(a){return a?c.marked(a):"<p>No text</p>"};var b=function(a){if(void 0!==a){var b=new Date;a.forEach(function(a){b.setTime(1E3*a.timestamp);a.date=b.toLocaleString()})}},e=function(c){a.viewItem=c;a.viewItem.laneName=a.laneNames[c.lane_id];
b(a.viewItem.ownComment);b(a.viewItem.ownAttachment);b(a.viewItem.ownActivity)};a.setColor=function(b){var c=b.color;if(1==b.total_loss)return"Red";if(b.color!=a.currentBoard.ownCategory[0].color)return b.color;a.currentBoard.ownCategory.forEach(function(a){a.id==b.category&&(c=a.color)});return c};a.openItem=function(b,c){void 0===c&&(c=!0);e(b);a.viewItem.disabled=!1;void 0===a.viewItem.ownComment&&(a.viewItem.ownComment=[]);void 0===a.viewItem.ownAttachment&&(a.viewItem.ownAttachment=[]);a.fileReset=
!0;c&&($(".itemViewModal textarea").css("height","auto"),$(".itemViewModal").modal({show:!0,keyboard:!1}))};a.$parent.openItem=a.openItem;a.editItem=function(){a.itemFormData.loadItem(a.viewItem);$(".itemViewModal").modal("hide");$(".itemModal").modal("show")};a.deleteItem=function(){noty({text:"Deleting an item cannot be undone.<br>Continue?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(b){b.close();a.viewItem.disabled=!0;d.removeItem(a.viewItem.id).success(function(b){a.alerts.showAlerts(b.alerts);
"success"==b.alerts[0].type&&(a.updateBoards(b),$(".itemViewModal").modal("hide"))})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.$parent.deleteItem=a.deleteItem;a.deleteComment=function(b){noty({text:"Deleting a comment cannot be undone.<br>Continue?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(c){c.close();d.removeItemComment(a.viewItem.id,b).success(function(b){a.alerts.showAlerts(b.alerts);"success"==
b.alerts[0].type&&e(b.data[0]);a.loadBoards()})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.attachmentDeleting=[];a.deleteAttachment=function(b){noty({text:"Deleting an attachment cannot be undone.<br>Continue?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(c){c.close();a.attachmentDeleting[b]=!0;d.removeItemAttachment(a.viewItem.id,b).success(function(b){a.alerts.showAlerts(b.alerts);"success"==b.alerts[0].type&&
e(b.data[0]);a.loadBoards()})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.addItemComment=function(b){""===b||void 0===b?a.alerts.showAlert({type:"error",text:"Comment cannot be empty."}):(a.viewItem.disabled=!0,d.addItemComment(a.viewItem.id,b).success(function(b){e(b.data[0]);a.loadBoards();a.viewItem.disabled=!1}),a.comment.text="")};a.beginEditComment=function(b,c){a.comment.isEdit=!0;a.comment.editText=c;a.comment.id=b};a.editComment=function(b,c){a.comment.isEdit=
!1;""===c||void 0===c?a.alerts.showAlert({type:"error",text:"Comment cannot be empty."}):(a.viewItem.disabled=!0,d.updateItemComment(b,c).success(function(b){e(b.data[0]);a.loadBoards();a.viewItem.disabled=!1}))};a.addItemAttachment=function(){void 0===a.itemUpload||""===a.itemUpload.name?a.alerts.showAlert({type:"error",text:"Select a file before uploading."}):(a.viewItem.disabled=!0,d.addItemAttachment(a.viewItem.id,a.itemUpload).success(function(b){e(b.data[0]);a.loadBoards();a.viewItem.disabled=
!1;a.fileReset=!0}).error(function(b){a.viewItem.disabled=!1;a.fileReset=!0;console.log(b);a.alerts.showAlert({type:"error",text:"There was an error with your attachment. The file may be too large."})}))}}]);taskBoardControllers.controller("FilesCtrl",["$scope","$routeParams","$http","$window","BoardService",function(a,c,d,b,e){a.file={id:c.fileId,loading:!0};d.get("api/items/1/upload/"+a.file.id).success(function(b){a.file.loading=!1;b.data?(a.file.data=b.data[0],b=new Date,b.setTime(1E3*a.file.data.timestamp),a.file.data.date=b.toLocaleString(),a.file.data.filename="api/uploads/"+a.file.data.filename):a.file.error=!0}).error(function(b){a.file.loading=!1;a.file.error=!0})}]);taskBoardControllers.controller("FrontDeskCtrl",["$scope","UserService","AlertService",function(a,c,d){a.alerts=d;a.techs=[];a.teams=[];a.repairOrders=[];a.completedRepairOrders=[];a.completedROs=[];a.teamNames=[];a.techNames=[];a.repairLaneNames="Pending;Tear Down;Supplement;Awaiting Parts;Body;Refinish;Trim Out;Service;Detail/Cleanup".split(";");a.techLookup={};a.teamLookup={};a.completedROsLookup={};a.boardLookup={};a.currentUser={};a.loadingCurrentUser=!0;a.loadingBoards=!0;a.loadingUsers=!0;
a.loadingTechs=!0;a.loadingRepairOrders=!0;a.loadingCompletedRepairOrders=!0;a.loadingTeams=!0;a.loadCurrentUser=function(){c.currentUser().success(function(b){a.currentUser=b.data;loadOptionsData(b.data);a.loadingCurrentUser=!1})};a.loadCurrentUser();loadOptionsData=function(b){a.currentUser.options.tasksOrder=parseInt(b.options.tasksOrder);a.currentUser.options.showAnimations=b.options.showAnimations;a.currentUser.options.showAssignee=b.options.showAssignee};a.updateTechList=function(b){if(void 0!==
b)if(a.loadingTechs=!1,null===b)a.techs=[];else{a.techs=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.techNames=c;b=0;for(var d=c.length;b<d;b++)a.techLookup[c[b].id]=c[b].name}};a.updateTeamsList=function(b){if(void 0!==b)if(a.loadingTeams=!1,null===b)a.teams=[];else{a.teams=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.teamNames=c;b=0;for(var d=c.length;b<d;b++)a.teamLookup[c[b].id]=c[b].name}};a.updateCompletedRepairOrders=function(b){if(void 0!==b&&null!==
b){a.completedRepairOrders=b;a.loadingCompletedRepairOrders=!1;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.repair_order_number})});a.completedROs=c;b=0;for(var d=c.length;b<d;b++)a.completedROsLookup[c[b].id]=c[b].name}};a.updateRepairOrders=function(b){if(void 0!==b&&null!==b){a.repairOrders=b;if(a.repairOrders){var c=new Date;a.repairOrders.forEach(function(a){c.setTime(1E3*a.drop_off_date);a.drop_off_date=c.toLocaleString();null!=a.refinish_start_date&&(c.setTime(1E3*a.refinish_start_date),
a.refinish_start_date=c.toLocaleString());null!=a.refinish_end_date&&(c.setTime(1E3*a.refinish_end_date),a.refinish_end_date=c.toLocaleString());null!=a.trim_out_start_date&&(c.setTime(1E3*a.trim_out_start_date),a.trim_out_start_date=c.toLocaleString());null!=a.trim_out_end_date&&(c.setTime(1E3*a.trim_out_end_date),a.trim_out_end_date=c.toLocaleString());null!=a.service_start_date&&(c.setTime(1E3*a.service_start_date),a.service_start_date=c.toLocaleString());null!=a.service_end_date&&(c.setTime(1E3*
a.service_end_date),a.service_end_date=c.toLocaleString());null!=a.tear_down_start_date&&(c.setTime(1E3*a.tear_down_start_date),a.tear_down_start_date=c.toLocaleString());null!=a.tear_down_end_date&&(c.setTime(1E3*a.tear_down_end_date),a.tear_down_end_date=c.toLocaleString());null!=a.body_start_date&&(c.setTime(1E3*a.body_start_date),a.body_start_date=c.toLocaleString());null!=a.body_end_date&&(c.setTime(1E3*a.body_end_date),a.body_end_date=c.toLocaleString());null!=a.check_in_date&&(c.setTime(1E3*
a.check_in_date),a.check_in_date=c.toLocaleString());null!=a.check_out_date&&(c.setTime(1E3*a.check_out_date),a.check_out_date=c.toLocaleString());null!=a.assignment_date&&(c.setTime(1E3*a.assignment_date),a.assignment_date=c.toLocaleString());null!=a.order_date&&(c.setTime(1E3*a.order_date),a.order_date=c.toLocaleString());null!=a.received_date&&(c.setTime(1E3*a.received_date),a.received_date=c.toLocaleString());null!=a.delivered_date&&(c.setTime(1E3*a.delivered_date),a.delivered_date=c.toLocaleString());
null!=a.estimate_date&&(c.setTime(1E3*a.estimate_date),a.estimate_date=c.toLocaleString())})}a.loadingRepairOrders=!1}}}]);taskBoardControllers.controller("RepairOrderFrontDeskCtrl",["$scope","$interval","RepairOrderService","TeamService","UserService",function(a,c,d,b,e){a.viewRepairOrder={};a.comment={};a.fileReset=!1;a.comments={options:[{id:0,text:"Oldest First"},{id:1,text:"Newest First"}],sorting:0};a.markedComment=function(a){return a?$window.marked(a):"<p>No text</p>"};a.totalLoss=function(b){$msg="Are you sure that "+b.repair_order_number+" is a total loss?";noty({text:$msg,layout:"center",type:"information",
modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.totalLoss(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddCheckout=function(b){alert("in add checkout");$msg="Are you sure that "+b.repair_order_number+" has been checked out? ";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.checkOut(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},
{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.finishedTask=function(b){$msg="Are you sure that you are done with the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.endProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddStart=function(b){$msg=
"Are you sure you want to start the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.startProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddSupplement=function(b){noty({text:"Are you sure you want to add a supplement?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",
text:"Yes",onClick:function(c){c.close();d.makeSupplement(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};var f=!1,h=3,g=!1,p=3,k=!1,q=3,m=!1,n=3,r=function(){m||(m=!0,e.getTechs().success(function(b){a.updateTechList(b.data);m=!1;n=3}).error(function(){n--?m=!1:(c.cancel(a.interval),a.$parent.loadingTechs=!1)}))},l=function(){f||(f=!0,d.getRepairOrders().success(function(b){a.updateRepairOrders(b.data);f=!1;h=3}).error(function(){h--?
f=!1:(c.cancel(a.interval),a.$parent.loadingRepairOrders=!1)}))},u=function(){g||(g=!0,d.getCompletedRepairOrders().success(function(b){a.updateCompletedRepairOrders(b.data);g=!1;p=3}).error(function(){p--?g=!1:(c.cancel(a.interval),a.$parent.loadingCompletedRepairOrders=!1)}))},t=function(){k||(k=!0,b.getTeams().success(function(b){a.updateTeamsList(b.data);k=!1;q=3}).error(function(){q--?k=!1:(c.cancel(a.interval),a.$parent.loadingTeams=!1)}))};t();r();l();u();a.interval=c(l,5E3);a.interval=c(u,
5E3);a.interval=c(t,5E3);a.interval=c(r,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});var s=function(a){if(void 0!==a){var b=new Date;a.forEach(function(a){b.setTime(1E3*a.timestamp);a.date=b.toLocaleString()})}},v=function(b){a.viewRepairOrder.repairOrderNumber=b.repair_order_number;a.viewRepairOrder.team=b.team;a.viewRepairOrder.name=b.name;a.viewRepairOrder.year=b.year;a.viewRepairOrder.make=b.make;a.viewRepairOrder.model=b.model;a.viewRepairOrder.color=b.color;a.viewRepairOrder.checkInId=
b.id;a.viewRepairOrder.bodyDays=b.body_days;a.viewRepairOrder.serviceDays=b.service_days;a.viewRepairOrder.refinishDays=b.refinish_days;a.viewRepairOrder.bodyHours=b.body_hours;a.viewRepairOrder.serviceHours=b.service_hours;a.viewRepairOrder.refinishHours=b.refinish_hours;a.viewRepairOrder.repairLane=b.repair_lane;a.viewRepairOrder.ownComment=b.own_comment;a.viewRepairOrder.ownAttachment=b.own_attachment;a.viewRepairOrder.ownActivity=b.own_activity;a.viewRepairOrder.totalLoss=b.total_loss;a.viewRepairOrder.laneId=
b.lane_id;a.viewRepairOrder.partsOrdered=b.parts_ordered;a.viewRepairOrder.backOrdered=b.back_ordered;a.viewRepairOrder.criticalBackOrder=b.critical_back_order;s(a.viewRepairOrder.ownComment);s(a.viewRepairOrder.ownAttachment);s(a.viewRepairOrder.ownActivity)};a.openPartsOrdered=function(b,c){void 0===c&&(c=!0);v(b);a.viewRepairOrder.disabled=!1;void 0===a.viewRepairOrder.ownComment&&(a.viewRepairOrder.ownComment=[]);void 0===a.viewRepairOrder.ownAttachment&&(a.viewRepairOrder.ownAttachment=[]);a.fileReset=
!0;c&&a.checkInFormData.loadCheckIn(a.viewRepairOrder)};a.openRO=function(b,c){void 0===c&&(c=!0);v(b);a.viewRepairOrder.disabled=!1;void 0===a.viewRepairOrder.ownComment&&(a.viewRepairOrder.ownComment=[]);void 0===a.viewRepairOrder.ownAttachment&&(a.viewRepairOrder.ownAttachment=[]);a.fileReset=!0;c&&a.checkInFormData.loadCheckIn(a.viewRepairOrder)};a.$parent.openRO=a.openRO}]);taskBoardControllers.controller("RepairOrderFormFrontDeskCtrl",["$scope","RepairOrderService","BoardService",function(a,c,d){a.checkInFormData={setFocus:!1,isSaving:!1,isAdd:!0,checkInId:0,name:"",repairOrderNumber:"",year:"",color:"",make:"",model:"",phoneNumber:"",cell:"",email:"",repairLane:0,laneId:0,team:null,bodyTech:null,serviceTech:null,refinishTech:null,rentalDate:null,insurance:"",insuranceEstimate:"",bodyHours:"",refinishHours:"",serviceHours:"",bodyDays:"",refinishDays:"",serviceDays:"",
checkInDate:"",dropOffDate:"",checkOutDate:"",comeBack:"",partsOrdered:"",backOrdered:"",criticalBackOrdered:"",isDPRC:!1,setCheckIn:function(a){this.reset();this.setFocus=!0;this.isSaving=!1;this.isAdd=!0;this.checkInId=a.checkInId;this.name=a.name;this.repairOrderNumber=a.repairOrderNumber;this.year=a.year;this.color=a.color;this.make=a.make;this.model=a.model;this.phoneNumber=a.phoneNumber;this.cell=a.cell;this.email=a.email;this.laneId=a.laneId;this.repairLane=a.repairLane;this.team=a.team;this.refinishTech=
a.refinishTech;this.serviceTech=a.serviceTech;this.bodyTech=a.bodyTech;this.rentalDate=a.rentalDate;this.insurance=a.insurance;this.insuranceEstimate=a.insuranceEstimate;this.bodyDays=a.bodyDays;this.refinishDays=a.refinishDays;this.serviceDays=a.serviceDays;this.bodyHours=a.bodyHours;this.refinishHours=a.refinishHours;this.serviceHours=a.serviceHours;this.checkInDate=a.checkInDate;this.dropOffDate=a.dropOffDate;this.checkOutDate=a.checkOutDate;this.comeBack=a.comeBack;this.isDPRC=a.isDPRC;this.partsOrdered=
a.partsOrdered;this.backOrdered=a.backOrdered;this.criticalBackOrdered=a.criticalBackOrdered},reset:function(){$(".popover-dismiss").popover();this.setFocus=!0;this.isSaving=!1;this.isAdd=!0;this.checkInId=0;this.email=this.cell=this.phoneNumber=this.model=this.make=this.color=this.year=this.repairOrderNumber=this.name="";this.laneId=this.repairLane=0;this.rentalDate=this.bodyTech=this.serviceTech=this.refinishTech=this.team=null;this.checkOutDate=this.dropOffDate=this.checkInDate=this.serviceHours=
this.refinishHours=this.bodyHours=this.serviceDays=this.refinishDays=this.bodyDays=this.insuranceEstimate=this.insurance="";this.isSaving=!1;this.comeBack="";this.isDPRC=!1;this.criticalBackOrdered=this.backOrdered=this.partsOrdered="";var a=this;$(".dropOffModal").on("hidden.bs.modal",function(c){a.reset()})},loadCheckIn:function(a){this.setFocus=!0;this.isAdd=this.isSaving=!1;this.checkInId=a.checkInId;this.name=a.name;this.repairOrderNumber=a.repairOrderNumber;this.year=a.year;this.color=a.color;
this.make=a.make;this.model=a.model;this.phoneNumber=a.phoneNumber;this.cell=a.cell;this.email=a.email;this.repairLane=a.repairLane;this.laneId=a.laneId;this.team=a.team;this.serviceTech=a.serviceTech;this.bodyTech=a.bodyTech;this.refinishTech=a.refinishTech;this.rentalDate=a.rentalDate;this.insurance=a.insurance;this.insuranceEstimate=a.insuranceEstimate;this.bodyHours=a.bodyHours;this.refinishHours=a.refinishHours;this.serviceHours=a.serviceHours;this.bodyDays=a.bodyDays;this.refinishDays=a.refinishDays;
this.serviceDays=a.serviceDays;this.checkInDate=a.checkInDate;this.dropOffDate=a.dropOffDate;this.checkOutDate=a.checkOutDate;this.comeBack=a.comeBack;this.isDPRC=a.isDPRC;this.partsOrdered=a.partsOrdered;this.backOrdered=a.backOrdered;this.criticalBackOrdered=a.criticalBackOrdered},cancel:function(){$(".partsOrderedModal").modal("hide");$(".shopManagerAssignModal").modal("hide");$(".writerEstimateModal").modal("hide");$(".frontDeskRepairOrderModal").modal("hide");var a=this;$(".partsOrderedModal").on("hidden.bs.modal",
function(c){a.reset()});$(".frontDeskRepairOrderModal").on("hidden.bs.modal",function(c){a.reset()});$(".writerEstimateModal").on("hidden.bs.modal",function(c){a.reset()});$(".shopManagerAssignModal").on("hidden.bs.modal",function(c){a.reset()})},setForSaving:function(){this.isSaving=!0;this.nameError=!1},setAlert:function(b,c){this.isSaving=!1;a.alerts.showAlert({type:"error",text:c})},datePicker:function(){$("#datepicker").datepicker()}};a.$parent.checkInFormData=a.checkInFormData;a.addPartsOrdered=
function(b){b.setForSaving();b.isSaving=!0;c.addPartsOrdered(b).success(function(c){a.alerts.showAlerts(c.alerts);a.updateRepairOrder(c.data);b.reset();"success"==c.alerts[0].type&&$(".partsOrderedModal").modal("hide")})};a.addAssignment=function(b){b.setForSaving();b.isSaving=!0;c.addAssignment(b).success(function(c){a.alerts.showAlerts(c.alerts);a.updateRepairOrder(c.data);b.reset();"success"==c.alerts[0].type&&$(".shopManagerAssignModal").modal("hide")})};a.addWriterEstimate=function(b){b.setForSaving();
b.isSaving=!0;c.addWriterEstimate(b).success(function(c){a.alerts.showAlerts(c.alerts);a.updateRepairOrder(c.data);b.reset();"success"==c.alerts[0].type&&$(".writerEstimateModal").modal("hide")})};a.addCheckIn=function(b){b.setForSaving();b.isSaving=!0;c.addRepairOrder(b).success(function(c){a.alerts.showAlerts(c.alerts);a.updateRepairOrder(c.data);b.reset();"success"==c.alerts[0].type&&$(".frontDeskRepairOrderModal").modal("hide")})}}]);taskBoardControllers.controller("HeaderCtrl",["$scope","$window","$location","UserService","AuthenticationService","AlertService",function(a,c,d,b,e,f){b.validateToken().error(a.logout);a.display={username:"",smallText:" - Settings"};a.$parent.display=a.display;a.$watch("currentUser",function(b,c){void 0!==b&&void 0!==b.username&&(a.display.username="("+b.username+")")});a.page={boards:!1,settings:!0};-1<d.path().indexOf("boards")&&(a.page.boards=!0,a.page.settings=!1,a.$watch("currentBoard.name",
function(b,c){a.display.smallText=b}));-1<d.path().indexOf("Front")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - Front Desk");-1<d.path().indexOf("Shop")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - Shop Mgr");-1<d.path().indexOf("Tech")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - Tech View");-1<d.path().indexOf("Report")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - Report View");-1<d.path().indexOf("Parts")&&(a.page.boards=!1,a.page.settings=
!1,a.display.smallText=" - Parts View");-1<d.path().indexOf("Writer")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - Writer View");-1<d.path().indexOf("files")&&(a.page.boards=!1,a.page.settings=!1,a.display.smallText=" - File Viewer");try{$.noty.closeAll()}catch(h){}a.logout=function(){b.logOut().then(function(a){e.reset();delete c.localStorage.token;d.path("/")})}}]);taskBoardControllers.controller("LoginCtrl",["$rootScope","$scope","$location","$window","UserService","AuthenticationService","AlertService",function(a,c,d,b,e,f,h){c.formdata={username:"",password:"",rememberme:!1};c.isSaving=!1;c.clear=function(){$("[name~=Modal]").modal("hide");$(".modal-backdrop").hide()};c.logIn=function(a){c.errors=[];c.isSaving=!0;e.logIn(a.username,a.password,a.rememberme).success(function(a){null!==a.alerts&&h.showAlerts(a.alerts);f.isAuthenticated=!0;b.localStorage.token=
a.data;d.path("/boards")}).error(function(a,b){c.isSaving=!1;c.errors.push(a.message);503===b&&(c.errors[0]+=" Ensure api directory is writable.")})}}]);taskBoardControllers.controller("ReportRepairOrderCtrl",["$scope","$interval","RepairOrderService","TeamService","UserService",function(a,c,d,b,e){a.viewRepairOrder={};a.comment={};a.fileReset=!1;a.comments={options:[{id:0,text:"Oldest First"},{id:1,text:"Newest First"}],sorting:0};a.markedComment=function(a){return a?$window.marked(a):"<p>No text</p>"};a.totalLoss=function(b){$msg="Are you sure that "+b.repair_order_number+" is a total loss?";noty({text:$msg,layout:"center",type:"information",modal:!0,
buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.totalLoss(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddCheckout=function(b){alert("in add checkout");$msg="Are you sure that "+b.repair_order_number+" has been checked out? ";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.checkOut(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},
{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.finishedTask=function(b){$msg="Are you sure that you are done with the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.endProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddStart=function(b){$msg=
"Are you sure you want to start the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.startProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddSupplement=function(b){noty({text:"Are you sure you want to add a supplement?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",
text:"Yes",onClick:function(c){c.close();d.makeSupplement(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};var f=!1,h=3,g=!1,p=3,k=!1,q=3,m=function(){k||(k=!0,e.getTechs().success(function(b){a.updateTechList(b.data);k=!1;q=3}).error(function(){q--?k=!1:(c.cancel(a.interval),a.$parent.loadingTechs=!1)}))},n=function(){f||(f=!0,d.getReportRepairOrders().success(function(b){a.updateRepairOrders(b.data);f=!1;h=3}).error(function(){h--?
f=!1:(c.cancel(a.interval),a.$parent.loadingRepairOrders=!1)}))},r=function(){g||(g=!0,b.getTeams().success(function(b){a.updateTeamsList(b.data);g=!1;p=3}).error(function(){p--?g=!1:(c.cancel(a.interval),a.$parent.loadingTeams=!1)}))};r();m();n();a.interval=c(n,5E3);a.interval=c(r,5E3);a.interval=c(m,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});var l=function(a){if(void 0!==a){var b=new Date;a.forEach(function(a){b.setTime(1E3*a.timestamp);a.date=b.toLocaleString()})}};a.openRO=function(b,
c){void 0===c&&(c=!0);a.viewRepairOrder.repairOrderNumber=b.repair_order_number;a.viewRepairOrder.team=b.team;a.viewRepairOrder.name=b.name;a.viewRepairOrder.year=b.year;a.viewRepairOrder.make=b.make;a.viewRepairOrder.model=b.model;a.viewRepairOrder.color=b.color;a.viewRepairOrder.checkInId=b.id;a.viewRepairOrder.bodyDays=b.body_days;a.viewRepairOrder.serviceDays=b.service_days;a.viewRepairOrder.refinishDays=b.refinish_days;a.viewRepairOrder.bodyHours=b.body_hours;a.viewRepairOrder.serviceHours=b.service_hours;
a.viewRepairOrder.refinishHours=b.refinish_hours;a.viewRepairOrder.repairLane=b.repair_lane;a.viewRepairOrder.ownComment=b.own_comment;a.viewRepairOrder.ownAttachment=b.own_attachment;a.viewRepairOrder.ownActivity=b.own_activity;a.viewRepairOrder.totalLoss=b.total_loss;a.viewRepairOrder.laneId=b.lane_id;l(a.viewRepairOrder.ownComment);l(a.viewRepairOrder.ownAttachment);l(a.viewRepairOrder.ownActivity);a.viewRepairOrder.disabled=!1;void 0===a.viewRepairOrder.ownComment&&(a.viewRepairOrder.ownComment=
[]);void 0===a.viewRepairOrder.ownAttachment&&(a.viewRepairOrder.ownAttachment=[]);a.fileReset=!0;c&&a.checkInFormData.loadCheckIn(a.viewRepairOrder)};a.$parent.openRO=a.openRO}]);taskBoardControllers.controller("SettingsCtrl",["$scope","UserService","AlertService",function(a,c,d){a.alerts=d;a.teams=[];a.insurances=[];a.users=[];a.boards=[];a.boardNames=[];a.teamNames=[];a.shopSettings=[];a.teamLookup={};a.boardLookup={};a.currentUser={};a.slide={open:!1};a.loadingCurrentUser=!0;a.loadingBoards=!0;a.loadingUsers=!0;a.loadingInsurance=!0;a.loadingTeams=!0;a.loadingShopSettings=!0;a.loadCurrentUser=function(){c.currentUser().success(function(b){a.currentUser=b.data;loadOptionsData(b.data);
a.loadingCurrentUser=!1})};a.loadCurrentUser();loadOptionsData=function(b){a.currentUser.options.tasksOrder=parseInt(b.options.tasksOrder);a.currentUser.options.showAnimations=b.options.showAnimations;a.currentUser.options.showAssignee=b.options.showAssignee};a.saveOptions=function(){c.saveOptions(a.currentUser.options.tasksOrder,a.currentUser.options.showAnimations,a.currentUser.options.showAssignee).success(function(a){loadOptionsData({options:a.data})})};a.updateTeamsList=function(b){if(void 0!==
b)if(a.loadingTeams=!1,null===b)a.teams=[];else{a.teams=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.teamNames=c;b=0;for(var d=c.length;b<d;b++)a.teamLookup[c[b].id]=c[b].name}};a.updateBoardsList=function(b){if(void 0!==b)if(a.loadingBoards=!1,null===b)a.boards=[];else{a.boards=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.teamNames=c;for(var d=0,h=c.length;d<h;d++)a.teamLookup[c[d].id]=c[d].name;a.boardNames=g;var g=[];b.forEach(function(a){g.push({id:a.id,
name:a.name,active:a.active})});a.boardNames=g;d=0;for(h=g.length;d<h;d++)a.boardLookup[g[d].id]=g[d].name;a.updateActions()}};a.updateTeams=function(b){void 0!==b&&null!==b&&(a.teams=b,a.loadingTeams=!1)};a.updateShopSettings=function(b){void 0!==b&&null!==b&&(a.shopSettings=b,a.loadingShopSettings=!1)};a.updateUsers=function(b){void 0!==b&&null!==b&&(a.users=b,a.loadingUsers=!1,a.updateActions())};a.updateInsurance=function(b){void 0!==b&&null!==b&&(a.insurances=b,a.loadingInsurance=!1)};a.actions=
[];a.actionsLoading=!0;a.updateActions=function(){"1"===a.currentUser.isAdmin&&c.actions().success(function(b){a.actions=b.data;if(a.actions){var c=new Date;a.actions.forEach(function(a){c.setTime(1E3*a.timestamp);a.date=c.toLocaleString()})}a.actionsLoading=!1})};a.updateActions()}]);taskBoardControllers.controller("AutomaticActionsCtrl",["$scope","$interval","BoardService",function(a,c,d){var b="#ffffe0";a.loadingActions=!0;a.actions=[];a.secondarySelection=[];a.boardCategories=[{id:0,name:"Uncategorized",color:b}];a.userList=[{id:0,name:"Unassigned",username:"Unassigned"}];a.actionData={isSaving:!1,board:null,trigger:0,triggerWord:"",secondary:null,action:0,color:null,category:null,assignee:null};a.actionDeleting=[];a.actionTypes=[{id:0,action:"Set item color"},{id:1,action:"Set item category"},
{id:2,action:"Set item assignee"},{id:3,action:"Clear item due date"}];a.actionOptions={triggers:[{id:0,trigger:"Item moves to column"},{id:1,trigger:"Item assigned to user"},{id:2,trigger:"Item set to category"}]};a.updateTriggers=function(){var b=!1;a.actionOptions.triggers.forEach(function(a){2===a.id&&(b=!0)},this);b||a.actionOptions.triggers.push({id:2,trigger:"Item set to category"});1===a.boardCategories.length&&(a.actionOptions.triggers.forEach(function(b,c){2===b.id&&a.actionOptions.triggers.splice(c,
1)}),a.actionTypes.forEach(function(b,c){1===b.id&&a.actionTypes.splice(c,1)}))};var e=function(b){if(null!==b&&void 0!==b){var c;a.boards.forEach(function(a){a.id===b&&(c=a)});return c}},f=function(a){var c=[{id:"0",name:"Uncategorized",color:b}];a&&a.ownCategory&&a.ownCategory.forEach(function(a){c.push(a)});return c},h=function(a){var b=[{id:"0",name:"Unassigned",username:"Unassigned"}];a&&a.sharedUser.forEach(function(a){b.push({id:a.id,name:a.username})});return b},g=function(a){var b=": ",c=
e(a.board_id),d=f(c),g=h(c);switch(parseInt(a.trigger_id)){case 0:c.ownLane.forEach(function(c){c.id===a.secondary_id&&(b+=c.name)});break;case 1:g.forEach(function(c){c.id===a.secondary_id&&(b+=c.name)});break;case 2:d.forEach(function(c){c.id===a.secondary_id&&(b+=c.name)})}return b},p=function(a){var b="",c=e(a.board_id),d=f(c),c=h(c);switch(parseInt(a.action_id)){case 0:b=": "+a.color;break;case 1:d.forEach(function(c){c.id===a.category_id&&(b=": "+c.name)});break;case 2:c.forEach(function(c){c.id===
a.assignee_id&&(b=": "+c.name)})}return b},k=function(b){if(b){var c=[];b.forEach(function(b){var d,e;a.actionOptions.triggers.forEach(function(a){a.id===parseInt(b.trigger_id)&&(d=a.trigger)});a.actionTypes.forEach(function(a){a.id===parseInt(b.action_id)&&(e=a.action)});c.push({id:b.id,board:a.boardLookup[b.board_id],trigger:d+g(b),action:e+p(b)})});a.actions=c}else a.actions=[]};a.loadActions=function(){d.getAutoActions().success(function(b){k(b.data);a.loadingActions=!1})};c(a.loadActions,2E3);
a.$watch("loadingBoards",function(){a.loadingBoards||a.loadActions()});a.addAction=function(){null===a.actionData.secondary||3!==a.actionData.action&&null===a.actionData.color&&null===a.actionData.category&&null===a.actionData.assignee?a.alerts.showAlert({type:"error",text:"One or more required fields are not entered. Automatic Action not added."}):(a.actionData.isSaving=!0,d.addAutoAction(a.actionData).success(function(b){a.actionData.isSaving=!1;a.alerts.showAlerts(b.alerts);"success"==b.alerts[0].type&&
k(b.data)}))};a.removeAction=function(b){a.actionDeleting[b]=!0;d.removeAutoAction(b).success(function(b){a.alerts.showAlerts(b.alerts);k(b.data)})};a.updateSecondary=function(){a.secondarySelection=[];a.actionData.secondary=null;a.actionData.action=0;var b=e(a.actionData.board);a.boardCategories=f(b);a.updateTriggers();a.userList=h(b);if(b)switch(a.actionData.trigger){case 0:a.secondarySelection=b.ownLane;break;case 1:a.secondarySelection=a.userList;break;case 2:a.secondarySelection=a.boardCategories}};
a.getTriggerWord=function(){if(null!==a.actionData.trigger){var b=a.actionOptions.triggers[a.actionData.trigger].trigger.split(" ").pop();a.actionData.triggerWord=b.charAt(0).toUpperCase()+b.slice(1)}a.updateSecondary()};a.getTriggerWord();a.resetActionSecondary=function(){a.actionData.color=null;a.actionData.category=null;a.actionData.assignee=null};b="#ffffe0";a.spectrum=function(c){c=c||b;$("#spectrum").spectrum({color:c,allowEmpty:!1,localStorageKey:"taskboard.colorPalette",showPalette:!0,palette:["#fff #ececec #ffffe0 #ffe0fa #bee7f4 #c3f4b5 #debee8 #ffdea9 #ffbaba".split(" ")],
showSelectionPalette:!0,showButtons:!1,showInput:!0,preferredFormat:"hex3",disabled:null===a.actionData.board})};a.updateColorpicker=function(){null!==a.actionData.board?($("#spectrum").spectrum("enable"),a.actionData.color=$("#spectrum").spectrum("option","color"),a.updateSecondary()):($("#spectrum").spectrum("disable"),a.actionData.color=null)};a.interval=c(function(){null!==a.actionData.board&&(c.cancel(a.interval),a.getTriggerWord())},500);a.$on("$destroy",function(){c.cancel(a.interval)})}]);taskBoardControllers.controller("BoardSettingsCtrl",["$scope","$interval","BoardService",function(a,c,d){var b=!1,e=3,f=function(){b||(b=!0,d.getBoards().success(function(c){a.updateBoardsList(c.data);b=!1;e=3}).error(function(d){e--?b=!1:(c.cancel(a.interval),a.$parent.loadingBoards=!1)}))};f();a.interval=c(f,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});a.userOptions={tasksAt:[{id:0,text:"bottom of column"},{id:1,text:"top of column"}],taskOrder:0,showAnimations:!0,showAssignee:!0};a.boardSort=
{options:[{sort:"id",name:"Creation Date"},{sort:"name",name:"Board Name"}],sort:"name"};a.boardFilter={options:[{filter:"all",name:"All Boards"},{filter:"active",name:"Active"},{filter:"inactive",name:"Inactive"}],filter:"all",userFilter:null};a.boardsFilter=function(b){switch(a.boardFilter.filter){case "all":return!0;case "active":return"1"===b.active;case "inactive":return"0"===b.active}};a.boardsUserFilter=function(b){if(null===a.boardFilter.userFilter)return!0;var c=!1;b.sharedUser.forEach(function(b){console.log(b.id===
a.boardFilter.userFilter);b.id===a.boardFilter.userFilter&&(c=!0)});return c};a.toggleActiveState=function(b){d.toggleActiveState(b).success(function(b){a.alerts.showAlerts(b.alerts);a.boards=b.data})};a.isDeleting=[];a.removeBoard=function(b){noty({text:"Deleting a board cannot be undone.<br>Continue?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(c){c.close();a.boards.forEach(function(c){c.id===b&&(a.isDeleting[b]=!0)});d.removeBoard(b).success(function(b){a.alerts.showAlerts(b.alerts);
a.boards=b.data;a.updateUsers(b.users)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})}}]);taskBoardControllers.controller("BoardFormSettingsCtrl",["$scope","BoardService",function(a,c){a.boardFormData={setFocus:!1,boardId:0,isAdd:!0,name:"",lanes:[],laneName:"",categories:[],categoryName:"",color:"#ffffe0",users:[],nameError:!1,lanesError:!1,categoriesError:!1,trackers:[],trackerName:"",bugexpr:"",trackersError:!1,isSaving:!1,updateLanesSorting:function(){var b=this;$(".lanes").sortable({placeholder:"lane-placeholder",stop:function(c,d){b.lanes.length=0;$(d.item).parent().children().each(function(a){b.lanes.push({id:$(this).find(".hidden").text(),
name:$(this).find(".item-text").text(),position:a})});a.$apply()}})},setBoard:function(a){this.reset();this.isAdd=!1;this.boardId=a.id;this.name=a.name;var c=this;void 0!==a.ownLane&&a.ownLane.forEach(function(a){c.lanes.push({id:a.id,name:a.name,position:a.position})});void 0!==a.ownCategory&&a.ownCategory.forEach(function(a){c.categories.push({id:a.id,name:a.name,color:a.color})});void 0!==a.ownTracker&&a.ownTracker.forEach(function(a){c.trackers.push({id:a.id,name:a.name,bugexpr:a.bugexpr})});
void 0!==a.sharedUser&&a.sharedUser.forEach(function(a){c.users[a.id]=!0});this.updateLanesSorting()},addLane:function(){this.lanesError=!1;if(""===this.laneName)this.setAlert(!1,!0,!1,!1,"Column  name cannot be empty.");else{var a=this;this.lanes.forEach(function(c){a.laneName==c.name&&(a.setAlert(!1,!0,!1,!1,"That column name has already been added."),a.lanesError=!0)});this.lanesError||this.lanes.push({id:0,name:this.laneName,position:this.lanes.length});this.laneName="";this.updateLanesSorting()}},
removeLane:function(a){if(!this.isSaving){this.lanes.splice(this.lanes.indexOf(a),1);var c=0;this.lanes.forEach(function(a){a.position=c;c++})}},addCategory:function(){this.categoriesError=!1;if(""===this.categoryName)this.setAlert(!1,!1,!0,!1,"Category name cannot be empty.");else{var a=this;this.categories.forEach(function(c){a.categoryName==c&&this.setAlert(!1,!1,!0,!1,"That category name has already been added.")});this.categoriesError||this.categories.push({id:0,name:this.categoryName,color:this.color});
this.categoryName=""}},removeCategory:function(a){this.isSaving||this.categories.splice(this.categories.indexOf(a),1)},addTracker:function(){this.trackersError=!1;if(""===this.trackerName)this.setAlert(!1,!1,!1,!0,"Issue Tracker URL cannot be empty.");else if(""===this.bugexpr)this.setAlert(!1,!1,!1,!0,"Bug ID regular expression cannot be empty.");else{var a=this;this.trackers.forEach(function(c){a.trackerName==c&&this.setAlert(!1,!1,!1,!0,"That Issue Tracker URL has already been added.")});this.trackersError||
this.trackers.push({id:0,name:this.trackerName,bugexpr:this.bugexpr});this.bugexpr=this.trackerName=""}},removeTracker:function(a){this.isSaving||this.trackers.splice(this.trackers.indexOf(a),1)},setForSaving:function(){this.trackersError=this.categoriesError=this.lanesError=this.nameError=!1;this.isSaving=!0},setAlert:function(b,c,d,h,g){this.nameError=b;this.lanesError=c;this.categoriesError=d;this.trackersError=h;this.isSaving=!1;a.alerts.showAlert({type:"error",text:g})},reset:function(){this.setFocus=
!0;this.boardId=0;this.isAdd=!0;this.name="";this.lanes=[];this.laneName="";this.categories=[];this.categoryName="";this.color="#ffffe0";$("#spectrum").spectrum("enable");a.spectrum("#ffffe0");this.users=[];this.categoriesError=this.lanesError=this.nameError=!1;this.trackers=[];this.bugexpr=this.trackerName="";this.isSaving=this.trackersError=!1},cancel:function(){$(".boardModal").modal("hide");$("#spectrum").spectrum("hide");$("#spectrum").spectrum("enable");var a=this;$(".boardModal").on("hidden.bs.modal",
function(c){a.reset()})}};a.$parent.boardFormData=a.boardFormData;a.spectrum=function(a){a=a||"#ffffe0";$("#spectrum").spectrum({color:a,allowEmpty:!1,localStorageKey:"taskboard.colorPalette",showPalette:!0,palette:["#fff #ececec #ffffe0 #ffe0fa #bee7f4 #c3f4b5 #debee8 #ffdea9 #ffbaba".split(" ")],showSelectionPalette:!0,showButtons:!1,showInput:!0,preferredFormat:"hex3"})};a.addBoard=function(b){b.setForSaving();$("#spectrum").spectrum("disable");d(b)&&c.addBoard(b).success(function(c){a.alerts.showAlerts(c.alerts);
a.updateBoardsList(c.data);b.reset();"success"==c.alerts[0].type&&$(".boardModal").modal("hide")})};a.editBoard=function(b){b.setForSaving();$("#spectrum").spectrum("disable");d(b)&&c.editBoard(b).success(function(c){a.alerts.showAlerts(c.alerts);a.updateBoardsList(c.data);b.reset();"success"==c.alerts[0].type&&$(".boardModal").modal("hide")})};a.editedCategory={};a.editColor=function(b){void 0===a.editedCategory.id?(a.editedCategory.id=b.id,a.editedCategory.name=b.name,a.editedCategory.color=a.boardFormData.color,
a.spectrum(b.color)):a.editedCategory.id!=b.id&&a.editedCategory.name!=b.name&&(a.spectrum(),a.editedCategory={})};a.storeColor=function(b){13===b.which?(a.boardFormData.categories.forEach(function(b){b.id==a.editedCategory.id&&b.name==a.editedCategory.name&&(b.color=a.boardFormData.color)}),a.spectrum(),a.editedCategory={}):27===b.which&&(a.spectrum(),a.editedCategory={})};var d=function(a){return""===a.name?(a.setAlert(!0,!1,!1,!1,"Board name cannot be empty."),!1):0===a.lanes.length?(a.setAlert(!1,
!0,!1,!1,"At least one lane is required."),!1):!0}}]);taskBoardControllers.controller("InsuranceSettingsCtrl",["$scope","$interval","InsuranceService",function(a,c,d){var b=!1,e=3,f=function(){b||(b=!0,d.getInsurance().success(function(c){a.updateInsurance(c.data);b=!1;e=3}).error(function(){e--?b=!1:(c.cancel(a.interval),a.$parent.loadingInsurance=!1)}))};f();a.interval=c(f,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});a.insuranceNameFormData={newInsuranceName:"",insuranceNameError:!1,isSaving:!1,setAlert:function(b){this.isSaving=!1;this.insuranceNameError=
!0;a.alerts.showAlert({type:"error",text:b})},reset:function(){this.newInsuranceName="";this.isSaving=this.insuranceNameError=!1}};a.changeInsuranceName=function(b){a.insuranceNameFormData.isSaving=!0;""===b.newTeamName?(b.setAlert("Insurance Name cannot be blank."),b.isSaving=!1):d.changeInsuranceName(b.newInsuranceName).success(function(c){a.alerts.showAlerts(c.alerts);a.updateInsurance(c.data);a.loadCurrentUser();b.isSaving=!1;b.newInsuranceName=""})};a.isDeleting=[];a.removeInsurance=function(b){noty({text:"Deleting a insurance cannot be undone.<br>Continue?",
layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(c){c.close();a.isDeleting[b]=!0;d.removeInsurance(b).success(function(b){a.alerts.showAlerts(b.alerts);a.updateInsurance(b.data);a.updateBoardsList(b.boards)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})}}]);taskBoardControllers.controller("InsuranceFormSettingsCtrl",["$scope","InsuranceService",function(a,c){a.insuranceFormData={setFocus:!1,insuranceId:0,isAdd:!0,name:"",cycleTime:"",nameError:!1,isSaving:!1,setInsurance:function(a){this.reset();this.isAdd=!1;this.insuranceId=a.id;this.name=a.name},reset:function(){$(".popover-dismiss").popover();this.setFocus=!0;this.insuranceId=0;this.isAdd=!0;this.name=this.cycleTime="";this.isSaving=this.nameError=!1;var a=this;$(".insuranceModal").on("hidden.bs.modal",
function(b){a.reset()})},loadInsurance:function(a){this.isAdd=!1;this.insuranceId=a.id;this.cycleTime=a.cycleTime;this.name=a.name},cancel:function(){$(".insuranceModal").modal("hide");var a=this;$(".insuranceModal").on("hidden.bs.modal",function(b){a.reset()})},setForSaving:function(){this.isSaving=!0;this.nameError=!1},setAlert:function(c,b,e){this.isSaving=!1;this.nameError=c;a.alerts.showAlert({type:"error",text:e})}};a.$parent.insuranceFormData=a.insuranceFormData;a.editInsurance=function(d){d.setForSaving();
""===d.name?d.setAlert(!0,!1,"Insurance name cannot be blank."):(d.isSaving=!0,c.editInsurance(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateInsurance(b.data);"success"==b.alerts[0].type&&$(".insuranceModal").modal("hide")}))};a.addInsurance=function(d){d.setForSaving();""===d.name?d.setAlert(!0,!1,"Insurance name cannot be blank."):(d.isSaving=!0,c.addInsurance(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateInsurance(b.data);d.reset();"success"==b.alerts[0].type&&$(".insuranceModal").modal("hide")}))}}]);taskBoardControllers.controller("ShopSettingsCtrl",["$scope","$interval","SettingsService",function(a,c,d){var b=!1,e=3,f=function(){b||(b=!0,d.getSettings().success(function(c){a.updateShopSettings(c.data);b=!1;e=3}).error(function(){e--?b=!1:(c.cancel(a.interval),a.$parent.loadingShopSettings=!1)}))};f();a.interval=c(f,5E3);a.$on("$destroy",function(){c.cancel(a.interval)})}]);taskBoardControllers.controller("ShopFormSettingsCtrl",["$scope","SettingsService",function(a,c){a.shopSettingsFormData={setFocus:!1,settingsId:0,isAdd:!0,tearDownDays:0,refinishDays:0,bodyDays:0,trimOutDays:0,serviceDays:0,hoursInDay:0,isSaving:!1,setShopSettings:function(a){this.reset();this.isAdd=!1;this.tearDownDays=a.tearDownDays;this.refinishDays=a.refinishDays;this.bodyDays=a.bodyDays;this.trimOutDays=a.trimOutDays;this.serviceDays=a.serviceDays;this.hoursInDay=a.hoursInDay},reset:function(){$(".popover-dismiss").popover();
this.setFocus=!0;this.settingsId=0;this.isAdd=!0;this.hoursInDay=this.serviceDays=this.trimOutDays=this.bodyDays=this.refinishDays=this.tearDownDays=0;this.isSaving=!1},cancel:function(){$(".shopSettingsModal").modal("hide");var a=this;$(".shopSettingsModal").on("hidden.bs.modal",function(b){a.reset()})},setForSaving:function(){this.isSaving=!0},setAlert:function(c,b,e){this.isSaving=!1;a.alerts.showAlert({type:"error",text:e})}};a.$parent.shopSettingsFormData=a.shopSettingsFormData;a.addShopSettings=
function(d){d.setForSaving();c.addSettings(d).success(function(b){a.updateShopSettings(b.data);d.reset();$(".shopSettingsModal").modal("hide")})}}]);taskBoardControllers.controller("TeamSettingsCtrl",["$scope","$interval","TeamService",function(a,c,d){var b=!1,e=3,f=function(){b||(b=!0,d.getTeams().success(function(c){a.updateTeamsList(c.data);b=!1;e=3}).error(function(){e--?b=!1:(c.cancel(a.interval),a.$parent.loadingTeams=!1)}))};f();a.interval=c(f,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});a.teamFormData={newName:"",nameError:!1,isSaving:!1,setAlert:function(b){this.nameError=!0;this.isSaving=!1;a.alerts.showAlert({type:"error",
text:b})},reset:function(){this.newName="";this.isSaving=this.newNameError=!1}};a.usernameFormData={newUsername:"",usernameError:!1,isSaving:!1,setAlert:function(b){this.isSaving=!1;this.usernameError=!0;a.alerts.showAlert({type:"error",text:b})},reset:function(){this.newUsername="";this.isSaving=this.usernameError=!1}};a.isDeleting=[];a.removeTeam=function(b){noty({text:"Deleting a team cannot be undone.<br>Continue?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",
text:"Ok",onClick:function(c){c.close();a.isDeleting[b]=!0;d.removeUser(b).success(function(b){a.alerts.showAlerts(b.alerts);a.updateTeams(b.data);a.updateBoardsList(b.boards)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})}}]);taskBoardControllers.controller("TeamFormSettingsCtrl",["$scope","TeamService",function(a,c){a.teamFormData={setFocus:!1,teamId:0,isAdd:!0,name:"",currentCapacity:0,maxCapacity:0,nameError:!1,isSaving:!1,setTeam:function(a){this.reset();this.isAdd=!1;this.teamId=a.id;this.name=a.name},reset:function(){$(".popover-dismiss").popover();this.setFocus=!0;this.teamId=0;this.isAdd=!0;this.maxCapacity=this.currentCapacity=0;this.name="";this.isSaving=this.nameError=!1;var a=this;$(".teamModal").on("hidden.bs.modal",
function(b){a.reset()})},loadTeam:function(a){this.isAdd=!1;this.teamId=a.id;this.currentCapacity=a.currentCapacity;this.maxCapacity=a.maxCapacity;this.name=a.name},cancel:function(){$(".teamModal").modal("hide");var a=this;$(".teamModal").on("hidden.bs.modal",function(b){a.reset()})},setForSaving:function(){this.isSaving=!0;this.nameError=!1},setAlert:function(c,b){this.isSaving=!1;this.nameError=c;a.alerts.showAlert({type:"error",text:b})}};a.$parent.teamFormData=a.teamFormData;a.editTeam=function(d){d.setForSaving();
""===d.name?d.setAlert(!0,!1,"Team name cannot be blank."):(d.isSaving=!0,c.editTeam(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateTeam(b.data);"success"==b.alerts[0].type&&$(".teamModal").modal("hide")}))};a.addTeam=function(d){d.setForSaving();""===d.name?d.setAlert(!0,!1,"Team name cannot be blank."):(d.isSaving=!0,c.addTeam(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateInsurance(b.data);d.reset();"success"==b.alerts[0].type&&$(".teamModal").modal("hide")}))}}]);taskBoardControllers.controller("UserSettingsCtrl",["$scope","$interval","UserService",function(a,c,d){var b=!1,e=3,f=function(){b||(b=!0,d.getUsers().success(function(c){a.updateUsers(c.data);b=!1;e=3}).error(function(){e--?b=!1:(c.cancel(a.interval),a.$parent.loadingUsers=!1)}))};f();a.interval=c(f,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});a.passwordFormData={currentPass:"",newPass:"",verifyPass:"",newPassError:!1,currentPassError:!1,isSaving:!1,setForSaving:function(){this.currentPassError=
this.newPassError=!1;this.isSaving=!0},setAlert:function(b,c,d){this.newPassError=b;this.currentPassError=c;this.isSaving=!1;a.alerts.showAlert({type:"error",text:d})},reset:function(){this.verifyPass=this.newPass=this.currentPass="";this.isSaving=this.currentPassError=this.newPassError=!1}};a.changePassword=function(b){b.setForSaving();""===b.currentPass?b.setAlert(!1,!0,"Current password cannot be blank."):""===b.newPass||""===b.verifyPass?b.setAlert(!0,!1,"New password cannot be blank."):b.newPass==
b.verifyPass?d.changePassword(b.currentPass,b.newPass).success(function(c){a.alerts.showAlerts(c.alerts);b.isSaving=!1;b.currentPass="";"Password changed."==c.alerts[0].text?b.reset():b.currentPassError=!0}):b.setAlert(!0,!1,"New passwords do not match.")};a.usernameFormData={newUsername:"",usernameError:!1,isSaving:!1,setAlert:function(b){this.isSaving=!1;this.usernameError=!0;a.alerts.showAlert({type:"error",text:b})},reset:function(){this.newUsername="";this.isSaving=this.usernameError=!1}};a.changeUsername=
function(b){a.usernameFormData.isSaving=!0;""===b.newUsername?(b.setAlert("Username cannot be blank."),b.isSaving=!1):d.changeUsername(b.newUsername).success(function(c){a.alerts.showAlerts(c.alerts);a.updateUsers(c.data);a.loadCurrentUser();b.isSaving=!1;b.newUsername=""})};a.emailFormData={newEmail:"",emailError:!1,isSaving:!1,setAlert:function(b){this.isSaving=!1;this.emailError=!0;a.alerts.showAlert({type:"error",text:b})},reset:function(){this.newEmail="";this.isSaving=this.emailError=!1}};a.changeEmail=
function(b){a.emailFormData.isSaving=!0;d.changeEmail(b.newEmail).success(function(c){a.alerts.showAlerts(c.alerts);a.updateUsers(c.data);a.loadCurrentUser();b.isSaving=!1;b.newUsername=""})};a.updatingDefaultBoard=!1;a.setDefaultBoard=function(){a.updatingDefaultBoard=!0;d.changeDefaultBoard(a.currentUser.defaultBoard).success(function(b){a.updatingDefaultBoard=!1;a.updateUsers(b.data);a.alerts.showAlert({type:"success",text:"Default board changed."})})};a.isDeleting=[];a.removeUser=function(b){noty({text:"Deleting a user cannot be undone.<br>Continue?",
layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Ok",onClick:function(c){c.close();a.isDeleting[b]=!0;d.removeUser(b).success(function(b){a.alerts.showAlerts(b.alerts);a.updateUsers(b.data);a.updateBoardsList(b.boards)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})}}]);taskBoardControllers.controller("UserFormSettingsCtrl",["$scope","UserService",function(a,c){a.userFormData={setFocus:!1,userId:0,isAdd:!0,name:"",username:"",password:"",email:"",verifyPass:"",defaultBoard:null,team:null,isAdmin:!1,isManager:!1,isTech:!1,isWriter:!1,isSuperUser:!1,currentWorkload:0,maxWorkload:0,passError:!1,usernameError:!1,emailError:!1,isSaving:!1,setUser:function(a){this.reset();this.isAdd=!1;this.userId=a.id;this.name=a.name;this.username=a.username;this.email=a.email;this.defaultBoard=
a.default_board;this.team=a.team;this.isAdmin="1"==a.is_admin;this.isManager="1"==a.is_manager;this.isTech="1"==a.is_tech;this.isWriter="1"==a.is_writer;this.isSuperUser="1"==a.is_super_user;this.currentWorkload=a.current_workload;this.maxWorkload=a.max_workload},reset:function(){$(".popover-dismiss").popover();this.setFocus=!0;this.userId=0;this.isAdd=!0;this.verifyPass=this.email=this.password=this.name=this.username="";this.team=this.defaultBoard=null;this.isSaving=this.usernameError=this.passError=
this.isSuperUser=this.isWriter=this.isTech=this.isManager=this.isAdmin=!1;this.maxWorkload=this.currentWorkload=0},cancel:function(){$(".userModal").modal("hide");var a=this;$(".userModal").on("hidden.bs.modal",function(b){a.reset()})},setForSaving:function(){this.isSaving=!0;this.passError=this.usernameError=!1},setAlert:function(c,b,e){this.isSaving=!1;this.usernameError=c;this.passError=b;a.alerts.showAlert({type:"error",text:e})}};a.$parent.userFormData=a.userFormData;a.editUser=function(d){d.setForSaving();
""===d.username?d.setAlert(!0,!1,"Username cannot be blank."):(d.isSaving=!0,d.password==d.verifyPass?c.editUser(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateUsers(b.data);a.updateBoardsList(b.boards);"success"==b.alerts[0].type&&($(".userModal").modal("hide"),d.password="",d.verifyPass="")}):d.setAlert(!1,!0,"Passwords do not match."))};a.addUser=function(d){d.setForSaving();""===d.username?d.setAlert(!0,!1,"Username cannot be blank."):""===d.password||""===d.verifyPass?d.setAlert(!1,
!0,"Password cannot be blank."):(d.isSaving=!0,d.password==d.verifyPass?c.addUser(d).success(function(b){a.alerts.showAlerts(b.alerts);a.updateUsers(b.data);a.updateBoardsList(b.boards);d.reset();"success"==b.alerts[0].type&&$(".userModal").modal("hide")}):d.setAlert(!1,!0,"Passwords do not match."))}}]);taskBoardControllers.controller("TechsCtrl",["$scope","UserService","AlertService",function(a,c,d){a.alerts=d;a.techs=[];a.teams=[];a.repairOrders=[];a.teamNames=[];a.techNames=[];a.repairLaneNames="Pending;Tear Down;Supplement;Awaiting Parts;Body;Refinish;Trim Out;Service;Detail/Cleanup".split(";");a.techLookup={};a.teamLookup={};a.boardLookup={};a.currentUser={};a.loadingCurrentUser=!0;a.loadingBoards=!0;a.loadingUsers=!0;a.loadingTechs=!0;a.loadingRepairOrders=!0;a.loadingTeams=!0;a.loadCurrentUser=
function(){c.currentUser().success(function(b){a.currentUser=b.data;loadOptionsData(b.data);a.loadingCurrentUser=!1})};a.loadCurrentUser();loadOptionsData=function(b){a.currentUser.options.tasksOrder=parseInt(b.options.tasksOrder);a.currentUser.options.showAnimations=b.options.showAnimations;a.currentUser.options.showAssignee=b.options.showAssignee};a.updateTechList=function(b){if(void 0!==b)if(a.loadingTechs=!1,null===b)a.techs=[];else{a.techs=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});
a.techNames=c;b=0;for(var d=c.length;b<d;b++)a.techLookup[c[b].id]=c[b].name}};a.updateTeamsList=function(b){if(void 0!==b)if(a.loadingTeams=!1,null===b)a.teams=[];else{a.teams=b;var c=[];b.forEach(function(a){c.push({id:a.id,name:a.name})});a.teamNames=c;b=0;for(var d=c.length;b<d;b++)a.teamLookup[c[b].id]=c[b].name}};a.updateRepairOrders=function(b){if(void 0!==b&&null!==b){a.repairOrders=b;if(a.repairOrders){var c=new Date;a.repairOrders.forEach(function(a){c.setTime(1E3*a.drop_off_date);a.drop_off_date=
c.toLocaleString();null!=a.refinish_start_date&&(c.setTime(1E3*a.refinish_start_date),a.refinish_start_date=c.toLocaleString());null!=a.refinish_end_date&&(c.setTime(1E3*a.refinish_end_date),a.refinish_end_date=c.toLocaleString());null!=a.trim_out_start_date&&(c.setTime(1E3*a.trim_out_start_date),a.trim_out_start_date=c.toLocaleString());null!=a.trim_out_end_date&&(c.setTime(1E3*a.trim_out_end_date),a.trim_out_end_date=c.toLocaleString());null!=a.service_start_date&&(c.setTime(1E3*a.service_start_date),
a.service_start_date=c.toLocaleString());null!=a.service_end_date&&(c.setTime(1E3*a.service_end_date),a.service_end_date=c.toLocaleString());null!=a.tear_down_start_date&&(c.setTime(1E3*a.tear_down_start_date),a.tear_down_start_date=c.toLocaleString());null!=a.tear_down_end_date&&(c.setTime(1E3*a.tear_down_end_date),a.tear_down_end_date=c.toLocaleString());null!=a.body_start_date&&(c.setTime(1E3*a.body_start_date),a.body_start_date=c.toLocaleString());null!=a.body_end_date&&(c.setTime(1E3*a.body_end_date),
a.body_end_date=c.toLocaleString());null!=a.check_in_date&&(c.setTime(1E3*a.check_in_date),a.check_in_date=c.toLocaleString());null!=a.check_out_date&&(c.setTime(1E3*a.check_out_date),a.check_out_date=c.toLocaleString());null!=a.assignment_date&&(c.setTime(1E3*a.assignment_date),a.assignment_date=c.toLocaleString());null!=a.estimate_date&&(c.setTime(1E3*a.estimate_date),a.estimate_date=c.toLocaleString())})}a.loadingRepairOrders=!1}}}]);taskBoardControllers.controller("RepairOrderTechsCtrl",["$scope","$interval","RepairOrderService","TeamService","UserService",function(a,c,d,b,e){a.viewRepairOrder={};a.comment={};a.fileReset=!1;a.comments={options:[{id:0,text:"Oldest First"},{id:1,text:"Newest First"}],sorting:0};a.markedComment=function(a){return a?$window.marked(a):"<p>No text</p>"};a.totalLoss=function(b){$msg="Are you sure that "+b.repair_order_number+" is a total loss?";noty({text:$msg,layout:"center",type:"information",modal:!0,
buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.totalLoss(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.finishedTask=function(b){$msg="Are you sure that you are done with the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.endProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},
{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddStart=function(b){$msg="Are you sure you want to start the "+a.repairLaneNames[b.repair_lane]+" process?";noty({text:$msg,layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.startProcess(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};a.openAddSupplement=function(b){noty({text:"Are you sure you want to add a supplement?",
layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(c){c.close();d.makeSupplement(b).success(function(b){a.alerts.showAlerts(b.alerts)})}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})};var f=!1,h=3,g=!1,p=3,k=!1,q=3,m=function(){k||(k=!0,e.getTechs().success(function(b){a.updateTechList(b.data);k=!1;q=3}).error(function(){q--?k=!1:(c.cancel(a.interval),a.$parent.loadingTechs=!1)}))},n=function(){f||(f=!0,d.getTechRepairOrders().success(function(b){a.updateRepairOrders(b.data);
f=!1;h=3}).error(function(){h--?f=!1:(c.cancel(a.interval),a.$parent.loadingRepairOrders=!1)}))},r=function(){g||(g=!0,b.getTeams().success(function(b){a.updateTeamsList(b.data);g=!1;p=3}).error(function(){p--?g=!1:(c.cancel(a.interval),a.$parent.loadingTeams=!1)}))};r();m();n();a.interval=c(n,5E3);a.interval=c(r,5E3);a.interval=c(m,5E3);a.$on("$destroy",function(){c.cancel(a.interval)});var l=function(a){if(void 0!==a){var b=new Date;a.forEach(function(a){b.setTime(1E3*a.timestamp);a.date=b.toLocaleString()})}};
a.openRO=function(b,c){void 0===c&&(c=!0);a.viewRepairOrder.repairOrderNumber=b.repair_order_number;a.viewRepairOrder.team=b.team;a.viewRepairOrder.name=b.name;a.viewRepairOrder.year=b.year;a.viewRepairOrder.make=b.make;a.viewRepairOrder.model=b.model;a.viewRepairOrder.color=b.color;a.viewRepairOrder.checkInId=b.id;a.viewRepairOrder.bodyDays=b.body_days;a.viewRepairOrder.serviceDays=b.service_days;a.viewRepairOrder.refinishDays=b.refinish_days;a.viewRepairOrder.bodyHours=b.body_hours;a.viewRepairOrder.serviceHours=
b.service_hours;a.viewRepairOrder.refinishHours=b.refinish_hours;a.viewRepairOrder.repairLane=b.repair_lane;a.viewRepairOrder.ownComment=b.own_comment;a.viewRepairOrder.ownAttachment=b.own_attachment;a.viewRepairOrder.ownActivity=b.own_activity;a.viewRepairOrder.totalLoss=b.total_loss;a.viewRepairOrder.laneId=b.lane_id;l(a.viewRepairOrder.ownComment);l(a.viewRepairOrder.ownAttachment);l(a.viewRepairOrder.ownActivity);a.viewRepairOrder.disabled=!1;void 0===a.viewRepairOrder.ownComment&&(a.viewRepairOrder.ownComment=
[]);void 0===a.viewRepairOrder.ownAttachment&&(a.viewRepairOrder.ownAttachment=[]);a.fileReset=!0;c&&a.checkInFormData.loadCheckIn(a.viewRepairOrder)};a.$parent.openRO=a.openRO}]);taskBoardControllers.controller("TechViewCtrl",["$scope","RepairOrderService",function(a,c){a.tvOrders=[];a.loadingTVOrders=!0;a.updateTVOrders=function(c){void 0!==c&&null!==c&&(a.tvOrders=c,a.loadingTVOrders=!1)};a.updateTVOrders();a.finishedTask=function(a){alert("In finised task");noty({text:"Are you sure you are done?",layout:"center",type:"information",modal:!0,buttons:[{addClass:"btn btn-default",text:"Yes",onClick:function(a){a.close()}},{addClass:"btn btn-info",text:"Cancel",onClick:function(a){a.close()}}]})}}]);taskBoardControllers.controller("TVRepairOrderCheckInCtrl",["$scope","RepairOrderService",function(a,c){var d=!1,b=3,e=function(){d||(d=!0,c.getRepairOrder().success(function(c){a.updateTVOrders(c.data);d=!1;b=3}).error(function(){b--?d=!1:($interval.cancel(a.interval),a.$parent.loadingTVOrders=!1)}))};e();a.interval=$interval(e,5E3);a.$on("$destroy",function(){$interval.cancel(a.interval)})}]);taskBoardServices.factory("AlertService",[function(){var a=function(a){noty({layout:"bottom",type:a.type,text:a.text,timeout:5E3})};return{showAlert:function(c){void 0!==c&&null!==c&&a(c)},showAlerts:function(c){void 0!==c&&null!==c&&c.length&&c.forEach(function(c){a(c)})}}}]);taskBoardServices.factory("AuthenticationService",[function(){return{isAuthenticated:!1,attemptedRoute:null,reset:function(){this.isAuthenticated=!1;this.attemptedRoute=null}}}]);taskBoardServices.factory("BoardService",["$http",function(a){return{getBoards:function(){return a.get("api/boards")},removeBoard:function(c){return a.post("api/boards/remove",{boardId:c})},addRepairOrder:function(c){return a.post("api/boards/ro",{repairOrderNumber:c.repairOrderNumber,year:c.year,make:c.make,model:c.model,color:c.color})},addBoard:function(c){return a.post("api/boards",{name:c.name,lanes:c.lanes,categories:c.categories,trackers:c.trackers,users:c.users})},editBoard:function(c){return a.post("api/boards/update",
{boardId:c.boardId,name:c.name,lanes:c.lanes,categories:c.categories,trackers:c.trackers,users:c.users})},toggleLane:function(c){return a.post("api/lanes/"+c+"/toggle")},toggleActiveState:function(c){return a.post("api/boards/"+c+"/toggleActive")},getAutoActions:function(){return a.get("api/autoactions")},addAutoAction:function(c){return a.post("api/autoactions",{boardId:c.board,triggerId:c.trigger,secondaryId:c.secondary,actionId:c.action,color:c.color,categoryId:c.category,assigneeId:c.assignee})},
removeAutoAction:function(c){return a.post("api/autoactions/remove",{actionId:c})},addItem:function(c,d){return a.post("api/boards/"+d+"/items",{title:c.title,description:c.description,assignee:c.assignee,category:c.category,color:c.color,dueDate:c.dueDate,points:c.points,lane:c.lane})},updateItem:function(c){return a.post("api/items/"+c.itemId,{title:c.title,description:c.description,assignee:c.assignee,category:c.category,color:c.color,dueDate:c.dueDate,points:c.points,lane:c.lane,position:c.position})},
updateItemPositions:function(c){return a.post("api/items/positions",{positions:c})},removeItem:function(c){return a.post("api/items/remove",{itemId:c})},addItemComment:function(c,d){return a.post("api/items/"+c+"/comment",{text:d})},updateItemComment:function(c,d){return a.post("api/comments/"+c,{text:d})},removeItemComment:function(c,d){return a.post("api/items/"+c+"/comment/remove",{id:d})},addItemAttachment:function(c,d){var b=new FormData;b.append("file",d);return a.post("api/items/"+c+"/upload",
b,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},removeItemAttachment:function(c,d){return a.post("api/items/"+c+"/upload/remove",{fileId:d})}}}]);taskBoardServices.factory("InsuranceService",["$http",function(a){return{currentUser:function(){return a.get("api/user/current")},changeTeamName:function(c){return a.post("api/updateteamname",{newTeamName:c})},changeWorkLoad:function(c){return a.post("api/updateteamworkload",{newWorkLoad:c})},getInsurance:function(){return a.get("api/insurance")},addInsurance:function(c){return a.post("api/insurance",{name:c.name,cycleTime:c.cycleTime})},editInsurance:function(c){return a.post("api/insurance/update",
{name:c.name,cycleTime:c.cycleTime})},removeInsurance:function(c){return a.post("api/insurance/remove",{insuranceId:c})}}}]);taskBoardServices.factory("RepairOrderService",["$http",function(a){return{currentUser:function(){return a.get("api/user/current")},addPartsOrdered:function(c){return a.post("api/addPartsOrdered",{id:c.checkInId,partsOrdered:c.partsOrdered,backOrdered:c.backOrdered,criticalBackOrder:c.criticalBackOrder})},getCompletedRepairOrders:function(){return a.get("api/completedRepairOrders")},getRepairOrders:function(){return a.get("api/frontDesk")},getReportRepairOrders:function(){return a.get("api/reportRepairOrders")},
getTechRepairOrders:function(){return a.get("api/techRepairOrders")},addAssignment:function(c){return a.post("api/shopAssignment",{id:c.checkInId,refinishTech:c.refinishTech,serviceTech:c.serviceTech,bodyTech:c.bodyTech})},startProcess:function(c){return a.post("api/startProcess",{id:c.id,repairLane:c.repair_lane})},endProcess:function(c){return a.post("api/endProcess",{id:c.id,repairLane:c.repair_lane})},checkOut:function(c){return a.post("api/checkOut",{id:c.id})},totalLoss:function(c){return a.post("api/totalLoss",
{id:c.id})},makeSupplement:function(c){return a.post("api/addSupplement",{id:c.id})},addWriterEstimate:function(c){return a.post("api/writerEstimate",{id:c.checkInId,rentalDate:c.rentalDate,insurance:c.insurance,insuranceEstimate:c.insuranceEstimate,bodyHours:c.bodyHours,refinishHours:c.refinishHours,serviceHours:c.serviceHours,isDPRC:c.isDPRC})},addRepairOrder:function(c){return a.post("api/frontDesk",{name:c.name,repairOrderNumber:c.repairOrderNumber,year:c.year,color:c.color,make:c.make,model:c.model,
phoneNumber:c.phoneNumber,email:c.email,cell:c.cell,comeBack:c.comeBack,team:c.team})}}}]);taskBoardServices.factory("SettingsService",["$http",function(a){return{currentUser:function(){return a.get("api/user/current")},getSettings:function(){return a.get("api/settings")},addSettings:function(c){return a.post("api/settings",{tearDownDays:c.tearDownDays,serviceDays:c.serviceDays,refinishDays:c.refinishDays,trimOutDays:c.trimOutDays,hoursInDay:c.hoursInDay,bodyDays:c.bodyDays})},editTeam:function(c){return a.post("api/team/update",{name:c.name,currentCapacity:c.currentCapacity,maxCapacity:c.maxCapacity})},
removeTeam:function(c){return a.post("api/team/remove",{teamId:c})}}}]);taskBoardServices.factory("TeamService",["$http",function(a){return{currentUser:function(){return a.get("api/user/current")},changeTeamName:function(c){return a.post("api/updateteamname",{newTeamName:c})},changeWorkLoad:function(c){return a.post("api/updateteamworkload",{newWorkLoad:c})},getTeams:function(){return a.get("api/teams")},addTeam:function(c){return a.post("api/teams",{name:c.name,currentCapacity:c.currentCapacity,maxCapacity:c.maxCapacity})},editTeam:function(c){return a.post("api/team/update",
{name:c.name,currentCapacity:c.currentCapacity,maxCapacity:c.maxCapacity})},removeTeam:function(c){return a.post("api/team/remove",{teamId:c})}}}]);taskBoardServices.factory("TokenInterceptor",["$q","$window","$location","AuthenticationService",function(a,c,d,b){return{request:function(a){a.headers=a.headers||{};c.localStorage.token&&(a.headers.Authorization=c.localStorage.token);return a},requestError:function(b){return a.reject(b)},response:function(d){null!==d&&200===d.status&&c.localStorage.token&&!b.isAuthenticated&&(b.isAuthenticated=!0);return d||a.when(d)},responseError:function(e){null!==e&&401===e.status&&(c.localStorage.token||b.isAuthenticated)&&
(delete c.localStorage.token,b.isAuthenticated=!1,d.path("/"));return a.reject(e)}}}]);taskBoardServices.factory("UserService",["$http",function(a){return{currentUser:function(){return a.get("api/users/current")},saveOptions:function(c,d,b){return a.post("api/users/current/options",{tasksOrder:c,showAnimations:d,showAssignee:b})},logIn:function(c,d,b){return a.post("api/login",{username:c,password:d,rememberme:b})},logOut:function(){return a.get("api/logout")},validateToken:function(){return a.get("api/authenticate")},changePassword:function(c,d){return a.post("api/updatepassword",
{currentPass:c,newPass:d})},changeUsername:function(c){return a.post("api/updateusername",{newUsername:c})},changeEmail:function(c){return a.post("api/updateemail",{newEmail:c})},changeDefaultBoard:function(c){return a.post("api/updateboard",{defaultBoard:c})},actions:function(){return a.get("api/actions")},getTechs:function(){return a.get("api/users/tech")},getUsers:function(){return a.get("api/users")},addUser:function(c){return a.post("api/users",{name:c.name,username:c.username,password:c.password,
email:c.email,defaultBoard:c.defaultBoard,boardAccess:c.boardAccess,isAdmin:c.isAdmin,isManager:c.isManager,isTech:c.isTech,isWriter:c.isWriter,team:c.team,isSuperUser:c.isSuperUser,currentWorkload:c.currentWorkload,maxWorkload:c.maxWorkload})},editUser:function(c){return a.post("api/users/update",{userId:c.userId,newUsername:c.username,password:c.password,email:c.email,defaultBoard:c.defaultBoard,boardAccess:c.boardAccess,isAdmin:c.isAdmin,isManager:c.isManager,isTech:c.isTech,isWriter:c.isWriter,
team:c.team,isSuperUser:c.isSuperUser,currentWorkload:c.currentWorkload,maxWorkload:c.maxWorkload})},removeUser:function(c){return a.post("api/users/remove",{userId:c})}}}]);taskBoardDirectives.directive("clickToEdit",function(){return{restrict:"A",replace:!0,templateUrl:"partials/clickToEdit.html",scope:{value:"=clickToEdit"},controller:["$scope",function(a){a.view={editableValue:a.value,editorEnabled:!1};a.enableEditor=function(){a.view.editableValue=a.value;a.view.editorEnabled=!0};a.save=function(){a.value=a.view.editableValue;a.view.editorEnabled=!1};a.checkKeypress=function(c){13===c.which?(a.save(),c.preventDefault()):27===c.which&&(a.view.editorEnabled=!1,c.preventDefault())}}]}});taskBoardDirectives.directive("fileUpload",["$parse",function(a){return{restrict:"A",link:function(c,d,b){var e=a(b.fileUpload),f=a(b.resetFlag);c.$watch(f,function(a){a&&(d[0].value="",f.assign(c,!1))});d.bind("change",function(){c.$apply(function(){e.assign(c,d[0].files[0])})})}}}]);taskBoardDirectives.directive("focus",["$timeout",function(a){return{link:function(c,d,b){c.$watch(b.focus,function(e){angular.isDefined(e)&&e&&a(function(){d[0].focus();c.$eval(b.focus+" = false")},500)},!0)}}}]);taskBoardDirectives.directive("includeReplace",function(){return{restrict:"A",replace:!0,templateUrl:function(a,c){return c.includeReplace}}});taskBoardDirectives.directive("onLoadCallback",function(){return{restrict:"A",terminal:!0,scope:{callback:"=onLoadCallback"},link:function(a,c,d){a.callback()}}});
